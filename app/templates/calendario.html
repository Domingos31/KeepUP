<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KeepUp - Calendário</title>

  <!-- Favicons -->
  <link href="{{ url_for('static', filename='images/Logo Keepup.png') }}" rel="icon" />
  <link href="{{ url_for('static', filename='images/apple-touch-icon.png') }}" rel="apple-touch-icon" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap & CSS -->
  <link href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='vendor/aos/aos.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" />

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />

  <style>
    #calendar {
      max-width: 1000px;
      margin: 40px auto;
    }
  </style>
</head>

<body class="calendario-page">

  <!-- Header -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid position-relative d-flex align-items-center justify-content-between">
      <a href="{{ url_for('index') }}" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">KeepUp</h1>
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="{{ url_for('index') }}">Terminar sessão</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="main" style="padding-top: 80px;">
    <section class="section d-flex align-items-center justify-content-center min-vh-100">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-12">
            <h2 class="text-center mb-4">O Meu Calendário</h2>
            <div id="calendar"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal para criar evento -->
  <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="eventForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="eventModalLabel">Criar Evento</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="eventTitle" class="form-label">Título</label>
            <input type="text" class="form-control" id="eventTitle" required />
          </div>
          <div class="mb-3">
            <label for="eventCategory" class="form-label">Categoria</label>
            <select class="form-select" id="eventCategory" required>
              <option value="">Selecionar...</option>
              <option value="Reunião">Reunião</option>
              <option value="Treino">Treino</option>
              <option value="Consulta">Consulta</option>
              <option value="Evento pessoal">Evento pessoal</option>
            </select>
          </div>
          <input type="hidden" id="eventStart" />
          <input type="hidden" id="eventEnd" />
          <input type="hidden" id="eventAllDay" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer id="footer" class="footer position-relative dark-background">
    <div class="container text-center">
      <h3 class="sitename">KeepUp</h3>
      <p>No sítio certo, à hora certa.</p>
      <div class="social-links d-flex justify-content-center mb-3">
        <a href="#"><i class="bi bi-twitter-x"></i></a>
        <a href="#"><i class="bi bi-facebook"></i></a>
        <a href="#"><i class="bi bi-instagram"></i></a>
        <a href="#"><i class="bi bi-skype"></i></a>
        <a href="#"><i class="bi bi-linkedin"></i></a>
      </div>
      <div>
        <span>&copy;</span> <strong class="px-1 sitename">KeepUp</strong> <span>Todos os direitos reservados</span>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='vendor/aos/aos.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales/pt.global.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');
      const categorias = {
        'Reunião': '#0d6efd',
        'Treino': '#28a745',
        'Consulta': '#ffc107',
        'Evento pessoal': '#dc3545'
      };

      const modal = new bootstrap.Modal(document.getElementById('eventModal'));
      const form = document.getElementById('eventForm');

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'pt',
        selectable: true,
        editable: true,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },

        select: function (info) {
          form.reset();
          document.getElementById('eventStart').value = info.startStr;
          document.getElementById('eventEnd').value = info.endStr;
          document.getElementById('eventAllDay').value = info.allDay;
          modal.show();
        },

        eventClick: function (info) {
          if (confirm(`Deseja apagar o evento "${info.event.title}"?`)) {
            info.event.remove();
          }
        }
      });

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const title = document.getElementById('eventTitle').value;
        const category = document.getElementById('eventCategory').value;
        const start = document.getElementById('eventStart').value;
        const end = document.getElementById('eventEnd').value;
        const allDay = document.getElementById('eventAllDay').value === "true";

        if (!title || !category) return;

        calendar.addEvent({
          title: title,
          start: start,
          end: end,
          allDay: allDay,
          backgroundColor: categorias[category],
          borderColor: categorias[category]
        });

        modal.hide();
        calendar.unselect();
      });

      calendar.render();
    });

    window.addEventListener('error', function (e) {
      alert("Erro: " + e.message);
    });
  </script>

</body>
</html>
